<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.bapai.diet.dao.DietDao">

    <insert id="insertDiet" useGeneratedKeys="true" keyProperty="dietId"
            parameterType="com.ssafy.bapai.diet.dto.DietDto">
        INSERT INTO diet (user_id, eat_date, meal_type, diet_img, memo, total_kcal, score, ai_analysis)
        VALUES (#{userId}, #{eatDate}, #{mealType}, #{dietImg}, #{memo}, #{totalKcal}, #{score}, #{aiAnalysis})
    </insert>

    <select id="selectDailyDiets" resultType="com.ssafy.bapai.diet.dto.DietDto">
        SELECT *
        FROM diet
        WHERE user_id = #{userId}
          AND eat_date = #{date}
        ORDER BY meal_type ASC
    </select>

    <select id="selectWeeklyDiets" resultType="com.ssafy.bapai.diet.dto.DietDto">
        SELECT *
        FROM diet
        WHERE user_id = #{userId}
          AND eat_date BETWEEN #{startDate} AND #{endDate}
        ORDER BY eat_date ASC, meal_type ASC
    </select>

    <select id="selectMonthlyDiets" resultType="com.ssafy.bapai.diet.dto.DietDto">
        SELECT *
        FROM diet
        WHERE user_id = #{userId}
          AND eat_date LIKE CONCAT(#{month}, '%')
        ORDER BY eat_date DESC
    </select>

    <select id="selectAllDiets" resultType="com.ssafy.bapai.diet.dto.DietDto">
        SELECT *
        FROM diet
        WHERE user_id = #{userId}
        ORDER BY eat_date DESC
    </select>

    <select id="selectDietDetail" resultType="com.ssafy.bapai.diet.dto.DietDto">
        SELECT *
        FROM diet
        WHERE diet_id = #{dietId}
    </select>

    <update id="updateDiet">
        UPDATE diet
        SET meal_type  = #{mealType},
            memo       = #{memo},
            total_kcal = #{totalKcal}
        WHERE diet_id = #{dietId}
    </update>

    <delete id="deleteDiet">
        DELETE
        FROM diet
        WHERE diet_id = #{dietId}
    </delete>

</mapper>