<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.bapai.ai.dao.ReportDao">

    <insert id="insertReportLog" parameterType="com.ssafy.bapai.ai.dto.ReportLogDto"
            useGeneratedKeys="true" keyProperty="reportId">
        INSERT INTO report_log (user_id, report_type, start_date, end_date, score_average, ai_message, created_at)
        VALUES (#{userId}, #{reportType}, #{startDate}, #{endDate}, #{scoreAverage}, #{aiMessage}, NOW())
    </insert>

    <select id="selectExistingReport" resultType="com.ssafy.bapai.ai.dto.ReportLogDto">
        SELECT report_id     as reportId,
               user_id       as userId,
               report_type   as reportType,
               start_date    as startDate,
               end_date      as endDate,
               score_average as scoreAverage,
               ai_message    as aiMessage,
               created_at    as createdAt
        FROM report_log
        WHERE user_id = #{userId}
          AND report_type = #{reportType}
          AND start_date = #{startDate}
          AND end_date = #{endDate}
        LIMIT 1
    </select>

</mapper>